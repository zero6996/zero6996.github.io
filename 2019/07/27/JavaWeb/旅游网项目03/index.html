<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>旅游网项目03 | Zero的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="黑马旅游网综合项目">
<meta name="keywords" content="Project">
<meta property="og:type" content="article">
<meta property="og:title" content="旅游网项目03">
<meta property="og:url" content="https://zero6996.github.io/2019/07/27/JavaWeb/旅游网项目03/index.html">
<meta property="og:site_name" content="Zero的博客">
<meta property="og:description" content="黑马旅游网综合项目">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="d:/资料/Java/img/route_info.jpg">
<meta property="og:image" content="d:/资料/Java/img/route_info2.jpg">
<meta property="og:image" content="d:/资料/Java/img/table.jpg">
<meta property="og:image" content="d:/资料/Java/img/favorite.jpg">
<meta property="og:image" content="d:/资料/Java/img/clickFavorite.jpg">
<meta property="og:updated_time" content="2020-01-03T11:43:19.609Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="旅游网项目03">
<meta name="twitter:description" content="黑马旅游网综合项目">
<meta name="twitter:image" content="d:/资料/Java/img/route_info.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Zero的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/images/4.jpg">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/highlight.css">
</head>
</html>
<body>
  <div id="fullpage" class="mobile-nav-right">
    
      <div id="wrapper" style="background-image: url(/images/wlop3.jpg)" title="图片作者wlop">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-right">
      
        <a class="nav-item" href="/" title
        
        >首页</a>
      
        <a class="nav-item" href="/archives" title
        
        >归档</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-right">
        <section id="main"><article id="post-JavaWeb/旅游网项目03" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 class="article-title" itemprop="name">
      旅游网项目03
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/2019/07/27/JavaWeb/旅游网项目03/" class="article-date">
  <time datetime="2019-07-27T15:59:00.000Z" itemprop="datePublished">2019-07-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaWeb/">JavaWeb</a>
  </div>

    
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Project/">Project</a></li></ul>

  </div>
  
    <span id="busuanzi_container_page_pv">
      本文总阅读量<span id="busuanzi_value_page_pv"></span>次
    </span>
  
    <!-- Table of Contents -->
  

  <div class="article-inner">
    
    <div class="article-content article-content-doorframe" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今日内容为旅游网项目的旅游线路名称查询，详情页展示，线路收藏功能。</p>
<a id="more"></a>
<h2 id="1-旅游线路名称查询功能"><a href="#1-旅游线路名称查询功能" class="headerlink" title="1. 旅游线路名称查询功能"></a>1. 旅游线路名称查询功能</h2><h3 id="1-1-查询参数的传递"><a href="#1-1-查询参数的传递" class="headerlink" title="1.1 查询参数的传递"></a>1.1 查询参数的传递</h3><p>在<code>header.html</code>中添加如下js</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给搜索按钮绑定单击事件，获取搜索输入框的内容</span></span><br><span class="line">$(<span class="string">"#search_btn"</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 用户输入的线路名称</span></span><br><span class="line">    <span class="keyword">var</span> rname = $(<span class="string">"#search_input"</span>).val();</span><br><span class="line">    <span class="keyword">var</span> cid = getParameter(<span class="string">"cid"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 跳转路径  http://localhost/travel/route_list.html?cid=5, 拼接上rname=xxx</span></span><br><span class="line">    location.href = <span class="string">"http://localhost/travel/route_list.html?cid="</span>+cid+<span class="string">"&amp;rname="</span>+rname;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>
<p>在<code>route_list.html</code>中添加代码</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 获取cid的参数值</span></span><br><span class="line">    <span class="keyword">var</span> cid = getParameter(<span class="string">"cid"</span>);</span><br><span class="line">    <span class="comment">// 获取rname的参数值</span></span><br><span class="line">    <span class="keyword">var</span> rname = getParameter(<span class="string">"rname"</span>);</span><br><span class="line">    <span class="comment">// 判断rname不为null</span></span><br><span class="line">    <span class="keyword">if</span> (rname)&#123;</span><br><span class="line">        <span class="comment">// url 解码</span></span><br><span class="line">        rname = <span class="built_in">window</span>.decodeURIComponent(rname);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div>
<h3 id="1-2-后台代码修改"><a href="#1-2-后台代码修改" class="headerlink" title="1.2 后台代码修改"></a>1.2 后台代码修改</h3><p>主要就是重构查询总记录数方法和查询当前页数据集合方法，添加一个模糊查询的参数<code>rname</code></p>
<p>设计到重构的模块及方法：</p>
<ol>
<li><code>RouteServlet</code>部分代修改及添加</li>
</ol>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加以下代码</span></span><br><span class="line"><span class="comment">// 接受rname 参数</span></span><br><span class="line">String rname = request.getParameter(<span class="string">"rname"</span>); </span><br><span class="line">rname = <span class="keyword">new</span> String(rname.getBytes(<span class="string">"iso-8859-1"</span>),<span class="string">"utf-8"</span>); <span class="comment">// 重新编码rnmae，解决get请求乱码问题</span></span><br><span class="line"><span class="comment">// 修改查询方法，添加rname参数</span></span><br><span class="line"><span class="comment">// 3. 调用service查询PageBean对象</span></span><br><span class="line">PageBean&lt;Route&gt; pb = routeService.pageQuery(cid, currentPage, pageSize,rname);</span><br></pre></td></tr></table></figure></div>
<ol start="2">
<li><code>RouteServiceImpl</code>代码修改</li>
</ol>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加rname参数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PageBean&lt;Route&gt; <span class="title">pageQuery</span><span class="params">(<span class="keyword">int</span> cid, <span class="keyword">int</span> currentPage, <span class="keyword">int</span> pageSize, String rname)</span> </span>&#123;&#125;</span><br><span class="line"><span class="comment">// 以下方法均添加rname参数</span></span><br><span class="line"><span class="keyword">int</span> totalCount = routeDao.findTotalCount(cid,rname);</span><br><span class="line">List&lt;Route&gt; list = routeDao.findByPage(cid, start, pageSize,rname);</span><br></pre></td></tr></table></figure></div>
<ol start="3">
<li><code>RouteDaoImpl</code>代码修改</li>
</ol>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findTotalCount</span><span class="params">(<span class="keyword">int</span> cid, String rname)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// String sql = "select count(*) from tab_route where cid = ?";</span></span><br><span class="line">    <span class="comment">// 1. 定义sql模板,拼接sql时注意空格</span></span><br><span class="line">    String sql = <span class="string">"select count(*) from tab_route where 1 = 1 "</span>;</span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder(sql);</span><br><span class="line"></span><br><span class="line">    List params = <span class="keyword">new</span> ArrayList(); <span class="comment">// 条件参数</span></span><br><span class="line">    <span class="comment">// 2. 判断参数是否有值</span></span><br><span class="line">    <span class="keyword">if</span> (cid != <span class="number">0</span>)&#123;</span><br><span class="line">        sb.append(<span class="string">" and cid = ? "</span>);</span><br><span class="line">        params.add(cid); <span class="comment">// 添加？对应值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rname != <span class="keyword">null</span> &amp;&amp; rname.length() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        sb.append(<span class="string">" and rname like ? "</span>);</span><br><span class="line">        params.add(<span class="string">"%"</span>+rname+<span class="string">"%"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sql = sb.toString(); <span class="comment">// 转换为字符串</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> template.queryForObject(sql,Integer<span class="class">.<span class="keyword">class</span>,<span class="title">params</span>.<span class="title">toArray</span>())</span>; <span class="comment">// params.toArray() 集合转换为数组</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Route&gt; <span class="title">findByPage</span><span class="params">(<span class="keyword">int</span> cid, <span class="keyword">int</span> start, <span class="keyword">int</span> pageSize, String rname)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// String sql = "select * from tab_route where cid = ? limit ? , ?";</span></span><br><span class="line">    <span class="comment">// 1. 定义sql模板</span></span><br><span class="line">    String sql = <span class="string">"select * from tab_route where 1 = 1 "</span>;</span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder(sql);</span><br><span class="line"></span><br><span class="line">    List params = <span class="keyword">new</span> ArrayList(); <span class="comment">// 条件参数集合</span></span><br><span class="line">    <span class="comment">// 2. 判断参数是否有值</span></span><br><span class="line">    <span class="keyword">if</span> (cid != <span class="number">0</span>)&#123;</span><br><span class="line">        sb.append(<span class="string">" and cid = ? "</span>);</span><br><span class="line">        params.add(cid); <span class="comment">// 添加？对应值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (rname != <span class="keyword">null</span> &amp;&amp; rname.length() &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        sb.append(<span class="string">" and rname like ? "</span>);</span><br><span class="line">        params.add(<span class="string">"%"</span>+rname+<span class="string">"%"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sb.append(<span class="string">" limit ? , ? "</span>); <span class="comment">// 分页条件限制</span></span><br><span class="line">    sql = sb.toString();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 加入分页条件参数</span></span><br><span class="line">    params.add(start);</span><br><span class="line">    params.add(pageSize);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> template.query(sql,<span class="keyword">new</span> BeanPropertyRowMapper&lt;Route&gt;(Route<span class="class">.<span class="keyword">class</span>),<span class="title">params</span>.<span class="title">toArray</span>())</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h3 id="1-3-前台代码修改"><a href="#1-3-前台代码修改" class="headerlink" title="1.3 前台代码修改"></a>1.3 前台代码修改</h3><p>主要将<code>rname</code>参数添加入<code>load</code>方法中，并且修改所有的跳转页面标签，加上<code>rname</code>参数。</p>
<blockquote>
<p>注意在标签处添加<code>rname</code>参数时，该参数是一个字符串，故需使用“\”进行转义。</p>
</blockquote>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// var search = location.search;</span></span><br><span class="line">            <span class="comment">// // alert(search);</span></span><br><span class="line">            <span class="comment">// // 切割字符串，拿到第二个值</span></span><br><span class="line">            <span class="comment">// var cid = search.split("=")[1];</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取cid的参数值</span></span><br><span class="line">            <span class="keyword">var</span> cid = getParameter(<span class="string">"cid"</span>);</span><br><span class="line">            <span class="comment">// 获取rname的参数值</span></span><br><span class="line">            <span class="keyword">var</span> rname = getParameter(<span class="string">"rname"</span>);</span><br><span class="line">            <span class="comment">// 判断rname不为null</span></span><br><span class="line">            <span class="keyword">if</span> (rname)&#123;</span><br><span class="line">                <span class="comment">// url 解码</span></span><br><span class="line">                rname = <span class="built_in">window</span>.decodeURIComponent(rname);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 当页码加载完毕后，调用load方法，</span></span><br><span class="line">            load(cid,<span class="literal">null</span>,rname);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params">cid, currentPage,rname</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 发送ajax请求，请求route/pageQuery，传递cid</span></span><br><span class="line">    $.<span class="keyword">get</span>("route/pageQuery",&#123;cid:cid,<span class="attr">currentPage</span>:currentPage,<span class="attr">rname</span>:rname&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">pb</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 解析PageBean数据，展示到页面上</span></span><br><span class="line">        <span class="comment">// 1. 分页工具条数据展示</span></span><br><span class="line">        <span class="comment">// 1.1 展示总页码和总记录数</span></span><br><span class="line">        $(<span class="string">"#totalPage"</span>).html(pb.totalPage);</span><br><span class="line">        $(<span class="string">"#totalCount"</span>).html(pb.totalCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> lis = <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">var</span> fristPage = <span class="string">'&lt;li onclick="javascript:load('</span>+cid+<span class="string">',1,\''</span>+rname+<span class="string">'\')"&gt;&lt;a href="javascript:void(0)"&gt;首页&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 计算上一页的页码</span></span><br><span class="line">        <span class="keyword">var</span> beforeNum = pb.currentPage - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (beforeNum &lt;= <span class="number">0</span>)&#123;</span><br><span class="line">            beforeNum = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> beforePage = <span class="string">'&lt;li onclick="javascript:load('</span>+cid+<span class="string">','</span>+beforeNum+<span class="string">',\''</span>+rname+<span class="string">'\')" class="threeword"&gt;&lt;a href="javascript:void(0)"&gt;上一页&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        lis += fristPage;</span><br><span class="line">        lis += beforePage;</span><br><span class="line">        <span class="comment">// 1.2 展示分页页码</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    仿百度分页样式：前五后四</span></span><br><span class="line"><span class="comment">                    1. 一共展示10个页码，能够达到前5后4的效果</span></span><br><span class="line"><span class="comment">                    2. 如果前边不足5个，后边补齐10个</span></span><br><span class="line"><span class="comment">                    3. 如果后边不足4个，前边补齐10个</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 定义开始位置begin和结束位置end</span></span><br><span class="line">        <span class="keyword">var</span> begin; <span class="comment">// 开始位置</span></span><br><span class="line">        <span class="keyword">var</span> end; <span class="comment">// 结束位置</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 显示10个页码</span></span><br><span class="line">        <span class="keyword">if</span>(pb.totalPage &lt; <span class="number">10</span>)&#123;</span><br><span class="line">            <span class="comment">// 总页码不足10页</span></span><br><span class="line">            begin = <span class="number">1</span>;</span><br><span class="line">            end = pb.totalPage;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 总页码超过10页</span></span><br><span class="line">            <span class="comment">// 实现前5后4效果</span></span><br><span class="line">            begin = pb.currentPage - <span class="number">5</span>;</span><br><span class="line">            end = pb.currentPage + <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 进行数据修正</span></span><br><span class="line">            <span class="comment">// 2. 如果前边不够5个，后边补齐10个</span></span><br><span class="line">            <span class="keyword">if</span> (begin &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                begin = <span class="number">1</span>;</span><br><span class="line">                end = begin + <span class="number">9</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 3. 如果后边不足4个，前边补齐10个</span></span><br><span class="line">            <span class="keyword">if</span> (end &gt; pb.totalPage)&#123;</span><br><span class="line">                end = pb.totalPage;</span><br><span class="line">                begin = end - <span class="number">9</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = begin; i &lt;= end; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> li;</span><br><span class="line">            <span class="comment">// 判断当前页码是否等于i</span></span><br><span class="line">            <span class="keyword">if</span> (pb.currentPage == i)&#123;</span><br><span class="line">                li = <span class="string">'&lt;li class="curPage" onclick="javascript:load('</span>+cid+<span class="string">','</span>+i+<span class="string">',\''</span>+rname+<span class="string">'\')"&gt;&lt;a href="javascript:void(0)"&gt;'</span>+i+<span class="string">'&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">// 创建页码的li</span></span><br><span class="line">                li = <span class="string">'&lt;li onclick="javascript:load('</span>+cid+<span class="string">','</span>+i+<span class="string">',\''</span>+rname+<span class="string">'\')"&gt;&lt;a href="javascript:void(0)"&gt;'</span>+i+<span class="string">'&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 拼接进字符串</span></span><br><span class="line">            lis += li;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 计算下一页页码</span></span><br><span class="line">        <span class="keyword">var</span> nextNum = pb.currentPage + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(nextNum &gt;= pb.totalPage)&#123;</span><br><span class="line">            nextNum = pb.totalPage;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> nextPage = <span class="string">'&lt;li onclick="javascript:load('</span>+cid+<span class="string">','</span>+nextNum+<span class="string">',\''</span>+rname+<span class="string">'\')" class="threeword"&gt;&lt;a href="javascript:void(0);"&gt;下一页&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line">        <span class="keyword">var</span> lastPage = <span class="string">'&lt;li onclick="javascript:load('</span>+cid+<span class="string">','</span>+pb.totalPage+<span class="string">',\''</span>+rname+<span class="string">'\')" class="threeword"&gt;&lt;a href="javascript:;"&gt;末页&lt;/a&gt;&lt;/li&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        lis += nextPage;</span><br><span class="line">        lis += lastPage;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将lis内容设置到ul中</span></span><br><span class="line">        $(<span class="string">"#pageNum"</span>).html(lis);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 列表数据展示</span></span><br><span class="line">        <span class="keyword">var</span> route_lis = <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; pb.list.length; i++) &#123;</span><br><span class="line">            <span class="comment">// 获取数据 &#123;rid": 1,"rname": "xxx","price": 999.0,xxxx&#125;</span></span><br><span class="line">            <span class="keyword">var</span> route = pb.list[i];</span><br><span class="line">            <span class="keyword">var</span> li = <span class="string">'&lt;li&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;div class="img"&gt;&lt;img src="'</span>+route.rimage+<span class="string">'" style="width: 299px"&gt;&lt;/div&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                    &lt;div class="text1"&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                    &lt;p&gt;'</span>+route.rname+<span class="string">'&lt;/p&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                    &lt;br/&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                    &lt;p&gt;'</span>+route.routeIntroduce+<span class="string">'&lt;/p&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;/div&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;div class="price"&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                    &lt;p class="price_num"&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                    &lt;span&gt;&amp;yen;&lt;/span&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;span&gt;'</span>+route.price+<span class="string">'&lt;/span&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;span&gt;起&lt;/span&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;/p&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;p&gt;&lt;a href="route_detail.html"&gt;查看详情&lt;/a&gt;&lt;/p&gt;\n'</span> +</span><br><span class="line">                <span class="string">'                &lt;/div&gt;\n'</span> +</span><br><span class="line">                <span class="string">'             &lt;/li&gt;'</span>;</span><br><span class="line"></span><br><span class="line">            route_lis += li;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $(<span class="string">"#route"</span>).html(route_lis);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 每次点击翻页后，定位到页面顶部</span></span><br><span class="line">        <span class="built_in">window</span>.scrollTo(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></div>
<p>​    </p>
<h2 id="2-旅游线路的详情展示"><a href="#2-旅游线路的详情展示" class="headerlink" title="2. 旅游线路的详情展示"></a>2. 旅游线路的详情展示</h2><h3 id="2-1-分析"><a href="#2-1-分析" class="headerlink" title="2.1 分析"></a>2.1 分析</h3><p><img src="D:\资料\Java\img\route_info.jpg" alt="route_info"></p>
<p><img src="D:\资料\Java\img\route_info2.jpg" alt="route_info2"></p>
<h3 id="2-2-后台代码实现"><a href="#2-2-后台代码实现" class="headerlink" title="2.2 后台代码实现"></a>2.2 后台代码实现</h3><ul>
<li>在<code>RouteServlet</code>中创建一个<code>findOne</code>方法，查询<code>route</code>对象并返回给客户端</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 根据id查询一个旅游线路的详细信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: zero</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/26 20:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findOne</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 接收id</span></span><br><span class="line">    String rid = request.getParameter(<span class="string">"rid"</span>);</span><br><span class="line">    <span class="comment">// 2. 调用service查询route对象</span></span><br><span class="line">    Route route = routeService.findOne(Integer.parseInt(rid));</span><br><span class="line">    <span class="comment">// 3. 转为json返回客户端</span></span><br><span class="line">    writeValue(route,response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>在<code>RouteServiceImpl</code>中新建<code>findOne</code>方法，根据<code>rid</code>查询三表数据，封装进<code>route</code>对象</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 根据rid查询三个表数据，封装进route对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: zero</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 封装好的route对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/26 21:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Route <span class="title">findOne</span><span class="params">(<span class="keyword">int</span> rid)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 根据id查询route对象 routeDao</span></span><br><span class="line">    Route route = routeDao.findOne(rid);</span><br><span class="line">    <span class="comment">// 2. 根据rid线路id查询tab_route_img，将集合设置到route对象中</span></span><br><span class="line">    List&lt;RouteImg&gt; img = routeImgDao.findImg(rid);</span><br><span class="line">    <span class="comment">// 2.1 将img集合设置到route对象中</span></span><br><span class="line">    route.setRouteImgList(img);</span><br><span class="line">    <span class="comment">// 3. 根据sid卖家id查询tab_seller查询卖家信息，设置到route对象中</span></span><br><span class="line">    Seller seller = sellerDao.findSeller(route.getSid());</span><br><span class="line">    <span class="comment">// 3.1 设置到route对象中</span></span><br><span class="line">    route.setSeller(seller);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> route;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>修改<code>RouteDao</code>层，添加<code>findOne</code>方法，新建两个Dao及其对应实现类，分别是<code>RouteImgDao</code>和<code>SellerDao</code>，查询图片信息和卖家信息。</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RouteDaoImpl</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据id查询</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Route <span class="title">findOne</span><span class="params">(<span class="keyword">int</span> rid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> template.queryForObject(<span class="string">"select * from tab_route where rid = ?"</span>,</span><br><span class="line">                                   <span class="keyword">new</span> BeanPropertyRowMapper&lt;Route&gt;(Route<span class="class">.<span class="keyword">class</span>),<span class="title">rid</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RouteImgDaoImpl</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据rid查询图片信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;RouteImg&gt; <span class="title">findImg</span><span class="params">(<span class="keyword">int</span> rid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> template.query(<span class="string">"select * from tab_route_img where rid = ?"</span>,</span><br><span class="line">                          <span class="keyword">new</span> BeanPropertyRowMapper&lt;RouteImg&gt;(RouteImg<span class="class">.<span class="keyword">class</span>),<span class="title">rid</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// SellerDaoImpl</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据sid查询卖家信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> sid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Seller <span class="title">findSeller</span><span class="params">(<span class="keyword">int</span> sid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> template.queryForObject(<span class="string">"select * from tab_seller where sid = ?"</span>,</span><br><span class="line">                                   <span class="keyword">new</span> BeanPropertyRowMapper&lt;Seller&gt;(Seller<span class="class">.<span class="keyword">class</span>),<span class="title">sid</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h3 id="2-3-前台代码实现"><a href="#2-3-前台代码实现" class="headerlink" title="2.3 前台代码实现"></a>2.3 前台代码实现</h3><p>在<code>Route_detail.html</code>中加载后获取rid，然后发送ajax请求，获取route对象，解析对象数据，填充入html中</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    goImg();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">goImg</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//焦点图效果</span></span><br><span class="line">    <span class="comment">//点击图片切换图片</span></span><br><span class="line">    $(<span class="string">'.little_img'</span>).on(<span class="string">'mousemove'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $(<span class="string">'.little_img'</span>).removeClass(<span class="string">'cur_img'</span>);</span><br><span class="line">        <span class="keyword">var</span> big_pic = $(<span class="keyword">this</span>).data(<span class="string">'bigpic'</span>);</span><br><span class="line">        $(<span class="string">'.big_img'</span>).attr(<span class="string">'src'</span>, big_pic);</span><br><span class="line">        $(<span class="keyword">this</span>).addClass(<span class="string">'cur_img'</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//上下切换</span></span><br><span class="line">    <span class="keyword">var</span> picindex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> nextindex = <span class="number">4</span>;</span><br><span class="line">    $(<span class="string">'.down_img'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> num = $(<span class="string">'.little_img'</span>).length;</span><br><span class="line">        <span class="keyword">if</span>((nextindex + <span class="number">1</span>) &lt;= num)&#123;</span><br><span class="line">            $(<span class="string">'.little_img:eq('</span>+picindex+<span class="string">')'</span>).hide();</span><br><span class="line">            $(<span class="string">'.little_img:eq('</span>+nextindex+<span class="string">')'</span>).show();</span><br><span class="line">            picindex = picindex + <span class="number">1</span>;</span><br><span class="line">            nextindex = nextindex + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    $(<span class="string">'.up_img'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> num = $(<span class="string">'.little_img'</span>).length;</span><br><span class="line">        <span class="keyword">if</span>(picindex &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            $(<span class="string">'.little_img:eq('</span>+(nextindex<span class="number">-1</span>)+<span class="string">')'</span>).hide();</span><br><span class="line">            $(<span class="string">'.little_img:eq('</span>+(picindex<span class="number">-1</span>)+<span class="string">')'</span>).show();</span><br><span class="line">            picindex = picindex - <span class="number">1</span>;</span><br><span class="line">            nextindex = nextindex - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//自动播放</span></span><br><span class="line">    <span class="comment">// var timer = setInterval("auto_play()", 5000);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//自动轮播方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">auto_play</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cur_index = $(<span class="string">'.prosum_left dd'</span>).find(<span class="string">'a.cur_img'</span>).index();</span><br><span class="line">    cur_index = cur_index - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> num = $(<span class="string">'.little_img'</span>).length;</span><br><span class="line">    <span class="keyword">var</span> max_index = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> ((num - <span class="number">1</span>) &lt; <span class="number">3</span>) &#123;</span><br><span class="line">        max_index = num - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cur_index &lt; max_index) &#123;</span><br><span class="line">        <span class="keyword">var</span> next_index = cur_index + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">var</span> big_pic = $(<span class="string">'.little_img:eq('</span> + next_index + <span class="string">')'</span>).data(<span class="string">'bigpic'</span>);</span><br><span class="line">        $(<span class="string">'.little_img'</span>).removeClass(<span class="string">'cur_img'</span>);</span><br><span class="line">        $(<span class="string">'.little_img:eq('</span> + next_index + <span class="string">')'</span>).addClass(<span class="string">'cur_img'</span>);</span><br><span class="line">        $(<span class="string">'.big_img'</span>).attr(<span class="string">'src'</span>, big_pic);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> big_pic = $(<span class="string">'.little_img:eq(0)'</span>).data(<span class="string">'bigpic'</span>);</span><br><span class="line">        $(<span class="string">'.little_img'</span>).removeClass(<span class="string">'cur_img'</span>);</span><br><span class="line">        $(<span class="string">'.little_img:eq(0)'</span>).addClass(<span class="string">'cur_img'</span>);</span><br><span class="line">        $(<span class="string">'.big_img'</span>).attr(<span class="string">'src'</span>, big_pic);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 获取id</span></span><br><span class="line">    <span class="keyword">var</span> rid = getParameter(<span class="string">"rid"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 发送请求， route/findOne</span></span><br><span class="line">    $.<span class="keyword">get</span>("route/findOne",&#123;rid:rid&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">route</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 3. 解析数据填充html</span></span><br><span class="line">        $(<span class="string">"#rname"</span>).html(route.rname);</span><br><span class="line">        $(<span class="string">"#routeIntroduce"</span>).html(route.routeIntroduce);</span><br><span class="line">        $(<span class="string">"#price"</span>).html(route.price);</span><br><span class="line">        $(<span class="string">"#sname"</span>).html(route.seller.sname);</span><br><span class="line">        $(<span class="string">"#consphone"</span>).html(route.seller.consphone);</span><br><span class="line">        $(<span class="string">"#address"</span>).html(route.seller.address);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 图片展示</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> dd_str = <span class="string">'&lt;a class="up_img up_img_disable"&gt;&lt;/a&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历routeImgList</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; route.routeImgList.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> a_str;</span><br><span class="line">            <span class="comment">// 判断图片是否大于4，将大于4的图片设置为display:none</span></span><br><span class="line">            <span class="keyword">if</span> (i &gt;= <span class="number">4</span>) &#123;</span><br><span class="line">                a_str = <span class="string">'&lt;a title="" class="little_img" data-bigpic="'</span>+route.routeImgList[i].bigPic+<span class="string">'" style="display:none;"&gt;\n'</span> +</span><br><span class="line">                    <span class="string">'                        &lt;img src="'</span>+route.routeImgList[i].smallPic+<span class="string">'"&gt;\n'</span> +</span><br><span class="line">                    <span class="string">'                    &lt;/a&gt;'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                a_str = <span class="string">'&lt;a title="" class="little_img" data-bigpic="'</span>+route.routeImgList[i].bigPic+<span class="string">'"&gt;\n'</span> +</span><br><span class="line">                    <span class="string">'                        &lt;img src="'</span>+route.routeImgList[i].smallPic+<span class="string">'"&gt;\n'</span> +</span><br><span class="line">                    <span class="string">'                    &lt;/a&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            dd_str += a_str;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        dd_str += <span class="string">'&lt;a class="down_img down_img_disable" style="margin-bottom: 0;"&gt;&lt;/a&gt;'</span>;</span><br><span class="line"></span><br><span class="line">        $(<span class="string">"#dd"</span>).html(dd_str);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 图片展示和切换代码的调用</span></span><br><span class="line">        goImg();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>需注意：在<code>route_list.html</code>中的查看详情URL处修改代码，传递rid值：<code>&lt;p&gt;&lt;a href=&quot;route_detail.html?rid=&#39;+route.rid+&#39;&quot;&gt;查看详情&lt;/a&gt;&lt;/p&gt;\n&#39;</code></p>
</blockquote>
<h2 id="3-旅游线路收藏功能"><a href="#3-旅游线路收藏功能" class="headerlink" title="3. 旅游线路收藏功能"></a>3. 旅游线路收藏功能</h2><h3 id="3-1-分析"><a href="#3-1-分析" class="headerlink" title="3.1 分析"></a>3.1 分析</h3><ul>
<li>表结构信息：</li>
</ul>
<p><img src="D:\资料\Java\img\table.jpg" alt="table"></p>
<h4 id="3-1-1-判断当前登录用户是否收藏过该线路"><a href="#3-1-1-判断当前登录用户是否收藏过该线路" class="headerlink" title="3.1.1 判断当前登录用户是否收藏过该线路"></a>3.1.1 判断当前登录用户是否收藏过该线路</h4><p>当页面加载完成后，发送ajax请求，获取用户是否收藏的标记，根据此标记展示不同的按钮样式。</p>
<p><img src="D:\资料\Java\img\favorite.jpg" alt="favorite"></p>
<h3 id="3-2-后台代码编写"><a href="#3-2-后台代码编写" class="headerlink" title="3.2 后台代码编写"></a>3.2 后台代码编写</h3><ul>
<li>修改<code>RouteServlet</code>，添加<code>isFavorite</code>方法</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 根据线路id和用户id，判断用户是否收藏了该线路</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: zero</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2019/7/27 23:11</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">isFavorite</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 获取rid，线路id</span></span><br><span class="line">    String rid = request.getParameter(<span class="string">"rid"</span>);</span><br><span class="line">    <span class="comment">// 2. 获取udi，通过当前登录用户对象，session</span></span><br><span class="line">    User user = (User) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">    <span class="comment">// 2.1 如果user对象为null，则表示未登录，设置uid=0</span></span><br><span class="line">    <span class="keyword">int</span> uid; <span class="comment">// 用户id</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 用户未登录</span></span><br><span class="line">        uid = <span class="number">0</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 用户已登录</span></span><br><span class="line">        uid = user.getUid();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3. 调用FavoriteService查询，传递rid，uid</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = favoriteService.isFavorite(Integer.parseInt(rid), uid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. 写回客户端flag标记</span></span><br><span class="line">    writeValue(flag,response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><code>FavoriteServiceImpl</code>添加<code>isFavorite</code>方法</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isFavorite</span><span class="params">(<span class="keyword">int</span> rid, <span class="keyword">int</span> uid)</span> </span>&#123;</span><br><span class="line">    Favorite favorite = favoriteDao.findFavorite(rid, uid);</span><br><span class="line">    <span class="keyword">return</span> favorite != <span class="keyword">null</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>; <span class="comment">// 如果对象有值，则表示收藏过了，返回true，反之表示未收藏过返回false。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><code>FavoriteDaoImpl</code>添加<code>findFavorite</code>方法</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 根据线路id和用户id查询数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: zero</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 查询到的Favorite对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2019/7/27 22:34</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Favorite <span class="title">findFavorite</span><span class="params">(<span class="keyword">int</span> rid, <span class="keyword">int</span> uid)</span> </span>&#123;</span><br><span class="line">    Favorite favorite = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        favorite = template.queryForObject(<span class="string">"select * from tab_favorite where rid = ? and uid = ? "</span>,</span><br><span class="line">                                           <span class="keyword">new</span> BeanPropertyRowMapper&lt;Favorite&gt;(Favorite<span class="class">.<span class="keyword">class</span>), <span class="title">rid</span>, <span class="title">uid</span>)</span>;</span><br><span class="line">    &#125;<span class="keyword">catch</span> (DataAccessException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> favorite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h3 id="3-3-前台代码编写"><a href="#3-3-前台代码编写" class="headerlink" title="3.3 前台代码编写"></a>3.3 前台代码编写</h3><p>在<code>route.detail.html</code>中添加<code>isFavorite</code>的js方法，在页面加载完毕后请求。</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFavorite</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 发送请求，判断用户是否收藏过该线路</span></span><br><span class="line">    <span class="keyword">var</span> rid = getParameter(<span class="string">"rid"</span>);</span><br><span class="line">    $.<span class="keyword">get</span>("route/isFavorite",&#123;rid:rid&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">flag</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (flag)&#123;</span><br><span class="line">            <span class="comment">// 用户已经收藏过了</span></span><br><span class="line">            <span class="comment">// &lt;a  class="btn already" disabled="disabled"&gt;</span></span><br><span class="line">            <span class="comment">// 设置收藏按钮的样式</span></span><br><span class="line">            $(<span class="string">"#favorite"</span>).addClass(<span class="string">"already"</span>);</span><br><span class="line">            $(<span class="string">"#favorite"</span>).attr(<span class="string">"disabled"</span>,<span class="string">"disabled"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 删除按钮的点击事件</span></span><br><span class="line">            $(<span class="string">"#favorite"</span>).removeAttr(<span class="string">"onclick"</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 用户没有收藏过</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<h3 id="3-4-收藏次数的动态展示"><a href="#3-4-收藏次数的动态展示" class="headerlink" title="3.4 收藏次数的动态展示"></a>3.4 收藏次数的动态展示</h3><p>前台代码：</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置收藏次数</span></span><br><span class="line">$(<span class="string">"#favoriteNumber"</span>).html(<span class="string">"已收藏"</span>+route.count+<span class="string">"次"</span>);</span><br></pre></td></tr></table></figure></div>
<p>后台添加一个查询次数方法即可</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RouteService, 在加载页面时调用findOne方法，同时将收藏次数也封装进Route对象中</span></span><br><span class="line"><span class="comment">// 4. 查询收藏次数</span></span><br><span class="line"><span class="keyword">int</span> count = favoriteDao.findFavoriteCount(route.getRid());</span><br><span class="line">route.setCount(count);</span><br><span class="line"></span><br><span class="line"><span class="comment">// FavoriteDao</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 根据rid查询收藏次数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: zero</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> rid</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 收藏次数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span> 2019/7/27 23:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">findFavoriteCount</span><span class="params">(<span class="keyword">int</span> rid)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> template.queryForObject(<span class="string">"select count(*) from tab_favorite where rid = ?"</span>, Integer<span class="class">.<span class="keyword">class</span>,<span class="title">rid</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h3 id="3-5-点击按钮收藏线路"><a href="#3-5-点击按钮收藏线路" class="headerlink" title="3.5 点击按钮收藏线路"></a>3.5 点击按钮收藏线路</h3><h4 id="3-5-1-分析"><a href="#3-5-1-分析" class="headerlink" title="3.5.1 分析"></a>3.5.1 分析</h4><p><img src="D:\资料\Java\img\clickFavorite.jpg" alt="clickFavorite"></p>
<h4 id="3-5-2-代码实现"><a href="#3-5-2-代码实现" class="headerlink" title="3.5.2 代码实现"></a>3.5.2 代码实现</h4><ul>
<li>前台代码</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击收藏按钮触发的方法</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addFavorite</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> rid = getParameter(<span class="string">"rid"</span>);</span><br><span class="line">    <span class="comment">// 1. 判断用户是否登录</span></span><br><span class="line">    $.<span class="keyword">get</span>("user/findOne",&#123;&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">user</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (user)&#123;</span><br><span class="line">            <span class="comment">// 用户登录了</span></span><br><span class="line">            <span class="comment">// 调用添加功能</span></span><br><span class="line">            $.<span class="keyword">get</span>("route/addFavorite",&#123;rid:rid&#125;,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;&#125;);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 刷新页面</span></span><br><span class="line">            location.reload();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 用户未登录</span></span><br><span class="line">            alert(<span class="string">"您未登录，请登录"</span>);</span><br><span class="line">            location.href = <span class="string">"http://localhost/travel/login.html"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>后台代码，在<code>RouteServlet</code>中添加<code>addFavorite</code>方法</li>
</ul>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 添加收藏功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: zero</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2019/7/27 23:46</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFavorite</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 获取线路id rid</span></span><br><span class="line">    String rid = request.getParameter(<span class="string">"rid"</span>);</span><br><span class="line">    <span class="comment">// 2. 获取用户对象 uid</span></span><br><span class="line">    User user = (User) request.getSession().getAttribute(<span class="string">"user"</span>);</span><br><span class="line">    <span class="keyword">int</span> uid; <span class="comment">// 用户id</span></span><br><span class="line">    <span class="keyword">if</span> (user == <span class="keyword">null</span>)&#123;</span><br><span class="line">        <span class="comment">// 用户未登录</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">// 用户已登录</span></span><br><span class="line">        uid = user.getUid();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 调用service添加</span></span><br><span class="line">    favoriteService.add(Integer.parseInt(rid), uid);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li><p>在<code>FavoriteServiceImpl</code>中添加<code>add</code>方法</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> rid, <span class="keyword">int</span> uid)</span> </span>&#123;</span><br><span class="line">    favoriteDao.add(rid,uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>在<code>FavoriteDaoImpl</code>中添加<code>add</code>方法</p>
<div class="highlight-box"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVA"><figure class="iseeu highlight /java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Description</span>: 添加收藏功能</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Author</span>: zero</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@Date</span> 2019/7/27 23:54</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> rid, <span class="keyword">int</span> uid)</span> </span>&#123;</span><br><span class="line">    template.update(<span class="string">"insert into tab_favorite values(?,?,?)"</span>,rid,<span class="keyword">new</span> Date(),uid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
</ul>

      
    </div>
    
      <footer class="article-footer">
        完
      </footer>
    
  </div>
  
    
<nav id="article-nav">
  <div class="article-nav-block">
    
      <a href="/2019/07/29/JavaWeb/travel项目开发日志/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption"></strong>
        <div class="article-nav-title">
          
            &#39;travel项目开发日志&#39;
          
        </div>
      </a>
    
  </div>
  <div class="article-nav-block">
    
      <a href="/2019/07/23/JavaWeb/旅游网项目02/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">旅游网项目02</div>
        <strong class="article-nav-caption"></strong>
      </a>
    
  </div>
</nav>

    <link rel="stylesheet" href="/css/gitment.css"> 
<script src="/js/gitment.js"></script>

<div id="gitmentContainer"></div>

<script>
var gitment = new Gitment({
  owner: '',
  repo: '',
  oauth: {
    client_id: '',
    client_secret: '',
  },
})
gitment.render('gitmentContainer')
</script>

  
  
</article>
</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/images/4.jpg" title="祢豆子"></img>
    <h3 class="avatar-name">
      
        zero
      
    </h3>
    <p class="avatar-slogan">
      在追赶前人的脚步上努力的Java菜鸟
    </p>
  </div>
</div>


  
    
  <div class="widget-box">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ComputerScience/">ComputerScience</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Interview/">Interview</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaWeb/">JavaWeb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java学习笔记/">Java学习笔记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL基础/">MySQL基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mybatis/">Mybatis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Other/">Other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring/">Spring</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SpringMVC/">SpringMVC</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-box">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CSS/" style="font-size: 10px;">CSS</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/HTTP/" style="font-size: 12px;">HTTP</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/IO流/" style="font-size: 12px;">IO流</a> <a href="/tags/JQuery/" style="font-size: 12px;">JQuery</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 12px;">JavaScript</a> <a href="/tags/MyBatis/" style="font-size: 12px;">MyBatis</a> <a href="/tags/Project/" style="font-size: 16px;">Project</a> <a href="/tags/Spring/" style="font-size: 18px;">Spring</a> <a href="/tags/SpringMVC/" style="font-size: 14px;">SpringMVC</a> <a href="/tags/反射/" style="font-size: 10px;">反射</a> <a href="/tags/数组/" style="font-size: 10px;">数组</a> <a href="/tags/线程/" style="font-size: 12px;">线程</a> <a href="/tags/计算机网络/" style="font-size: 10px;">计算机网络</a> <a href="/tags/随笔/" style="font-size: 12px;">随笔</a> <a href="/tags/集合/" style="font-size: 12px;">集合</a>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/02/29/Other/hexo部署至coding/">Hexo部署至coding</a>
          </li>
        
          <li>
            <a href="/2020/01/22/ComputerScience/04_二进制/">计科04:[二进制]</a>
          </li>
        
          <li>
            <a href="/2020/01/10/ComputerScience/03_布尔逻辑和逻辑门/">计科03:[布尔代数和逻辑门]</a>
          </li>
        
          <li>
            <a href="/2020/01/08/ComputerScience/02_电子计算机/">计科02:[电子计算机]</a>
          </li>
        
          <li>
            <a href="/2020/01/03/ComputerScience/01_计算机早期历史/">计科01:[计算机早期历史]</a>
          </li>
        
      </ul>
    </div>
  </div>

  
      <div class="widget-box">
    <h3 class="widget-title">友链</h3>
    <div class="widget">
      
        <a style="display: block;" href="https://blog.littleha.cn/" title target='_blank'
        >小哈博客</a>
      
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2020 Zero &nbsp;&nbsp;
    驱动于 <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;主题 <a href="https://github.com/yiluyanxia/hexo-theme-antiquity">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">不蒜子告之   阁下是第<span id="busuanzi_value_site_pv"></span>个访客</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":145,"height":315},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
<!-- 添加页面点击小红心js效果-->
{% if theme.clicklove %}
  <script type="text/javascript" src="/js/clicklove.js"></script>
{% endif%}

<!--页面标题崩溃欺骗-->
<script type="text/javascript" src="/js/crash_cheat.js"></script>